# Testing the contracts

## Overview

This document describes the process to generate wallets for admin, offerer, and claimant; distribute some testnet Ada to the wallets to pay fees; create the minting policy for our bridge NFT; create the bridge validator script; mint the NFT and lock it at the bridge's address.

## Install deps

```
sudo apt-get install jq
npm install
```

## Create directory for application data

We use the link:var[] directory to store application data.  In this repo, it is checked in for demonstration purposes.

```
mkdir var
```

## Generate keys for admin as well as bounty offerer and claimant

We use the link:generate-keys.mjs[] script to generate addresses (e.g. link:var/admin.addr[]), pubkey hashes (e.g. link:var/admin.pkh[]), and private keys (e.g. link:var/admin.skey[]) for an admin, a bounty offerer, and a bounty claimant.

```
node generate-keys.mjs var/admin
node generate-keys.mjs var/offerer
node generate-keys.mjs var/claimant
```

## Set up Blockfrost provider

Replace YOUR_BLOCKFROST_API_KEY and call the following command to create link:var/blockfrost.api-key[].

```
echo YOUR_BLOCKFROST_API_KEY > var/blockfrost.api-key
```

## Get funds from testnet faucet

Get the admin's address from link:var/admin.addr[]:

```
cat var/admin.addr
```

Go to https://docs.cardano.org/cardano-testnets/tools/faucet/

Send funds to the admin address.

## Distribute some Ada to bounty offerer and claimant

We use the link:send-lovelace.mjs[] script to send some Ada for paying fees to the bounty offerer and claimant.

```
node send-lovelace.mjs var/offerer
node send-lovelace.mjs var/claimant
```

## Create NFT minting policy

Supplies the admin's public key hash as input to the link:../app/GenMintingPolicyBlueprint.hs[] command to produce the link:var/sky-minting-policy.json[] minting policy Blueprint JSON.

```
cabal run gen-minting-policy-blueprint -- "$(cat var/admin.pkh)" var/sky-minting-policy.json
```

## Extract minting policy hash

Use jq to extract the minting policy hash from the policy file and write it into link:var/sky-minting-policy.hash[].

```
cat var/sky-minting-policy.json | jq -r '.validators[0].hash' > var/sky-minting-policy.hash
```

## Generate Bridge Validator

Supply the minting policy hash from link:var/sky-minting-policy.hash[] as argument to the link:../app/GenValidatorBlueprint.hs[] command in order to produce the link:var/sky-bridge-validator.json[] Blueprint JSON for the validator.

```
cabal run gen-validator-blueprint -- "$(cat var/sky-minting-policy.hash)" var/sky-bridge-validator.json
```

## Mint the NFT at the bridge's address

Now that we have the validator script in link:var/sky-bridge-validator.json[], we can mint the NFT and lock it at the address of the validator with the link:mint-nft.mjs[] script. 

```
node mint-nft.mjs
```

The NFT locked at the address on the Preview testnet can be viewed here:

https://preview.cardanoscan.io/tokenHoldings/addr_test1wqvwnk2mcdx92f9grcahrqcx47r0zk3vgrnw02mdqzclmsq8lfgue
