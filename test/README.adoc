# Testing the contracts

Inside the `test` directory:

## Install deps

```
sudo apt-get install jq
npm install
```

## Create directory for application data

We use the link:var[] directory to store application data.  In this repo, it is checked in for demonstration purposes.

```
mkdir var
```

## Generate keys for admin as well as bounty offerer and claimant

We use the link:generate-keys.mjs[] script to generate addresses (e.g. link:var/admin.addr[]), pubkey hashes (e.g. link:var/admin.pkh[]), and private keys (e.g. link:var/admin.skey[]) for an admin, a bounty offerer, and a bounty claimant.

```
node generate-keys.mjs var/admin
node generate-keys.mjs var/offerer
node generate-keys.mjs var/claimant
```

## Set up Blockfrost provider

Replace YOUR_BLOCKFROST_API_KEY and call the following command to create link:var/blockfrost.api-key[].

```
echo YOUR_BLOCKFROST_API_KEY > var/blockfrost.api-key
```

## Get funds from testnet faucet

Get the admin's address from link:var/admin.addr[]:

```
cat var/admin.addr
```

Go to https://docs.cardano.org/cardano-testnets/tools/faucet/

Send funds to the admin address.

## Distribute some Ada to bounty offerer and claimant

We use the link:send-lovelace.mjs[] script to send some Ada for paying fees to the bounty offerer and claimant.

```
node send-lovelace.mjs var/offerer
node send-lovelace.mjs var/claimant
```

## Create NFT minting policy

Supplies the offerer's public key hash as input to the link:../app/GenMintingPolicy.hs[] command to produce the link:var/sky-minting-policy.json[] minting policy Blueprint JSON.

```
cabal run gen-minting-policy-blueprint -- "$(cat var/offerer.pkh)" var/sky-minting-policy.json
```

## Extract minting policy hash

```
cat var/sky-minting-policy.json | jq -r '.validators[0].hash' > var/sky-minting-policy.hash
```

## Generate Bridge Validator

```
cabal run gen-validator-blueprint -- "$(cat var/sky-minting-policy.hash)" var/sky-bridge-validator.json
```

Minted a token at address addr_test1wqvwnk2mcdx92f9grcahrqcx47r0zk3vgrnw02mdqzclmsq8lfgue.
Tx hash: 24f69d3fc547a8b1005964917e9e77b904d22dc7d3dc54ff19dc611bab9a5c65

https://preview.cardanoscan.io/tokenHoldings/addr_test1wqvwnk2mcdx92f9grcahrqcx47r0zk3vgrnw02mdqzclmsq8lfgue
